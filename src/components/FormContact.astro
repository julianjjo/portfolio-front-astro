---
import Toast from "./Toast.astro";
---

<div class="max-w-4xl mx-auto w-full animate-slide-up">
  <form
    action=""
    id="loginForm"
    class="glass-card rounded-3xl p-8 md:p-12 shadow-2xl relative overflow-hidden"
  >
    <!-- Decorative element -->
    <div
      class="absolute top-0 left-0 w-24 h-24 bg-violet-600/10 blur-3xl pointer-events-none"
    >
    </div>
    <div
      class="absolute bottom-0 right-0 w-32 h-32 bg-cyan-600/10 blur-3xl pointer-events-none"
    >
    </div>

    <div class="mb-10 text-center md:text-left">
      <h2
        class="text-4xl font-black text-white playfair-display mb-2"
        id="animated-text"
      >
        Contact Me
      </h2>
      <p class="text-slate-400 text-sm">
        Have a project in mind? Let's build something extraordinary.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="space-y-2">
        <label
          for="email"
          class="text-xs font-bold uppercase tracking-widest text-slate-400 ml-1"
          >Email Address</label
        >
        <input
          id="email"
          name="email"
          type="email"
          placeholder="your@email.com"
          required
          class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white placeholder:text-slate-600 focus:outline-none focus:border-violet-500/50 focus:ring-4 focus:ring-violet-500/10 transition-all duration-300"
        />
      </div>

      <div class="space-y-2">
        <label
          for="subject"
          class="text-xs font-bold uppercase tracking-widest text-slate-400 ml-1"
          >Subject</label
        >
        <input
          type="text"
          name="subject"
          id="subject"
          placeholder="New Collaboration"
          required
          class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white placeholder:text-slate-600 focus:outline-none focus:border-cyan-500/50 focus:ring-4 focus:ring-cyan-500/10 transition-all duration-300"
        />
      </div>
    </div>

    <div class="space-y-2 mb-10">
      <label
        for="message"
        class="text-xs font-bold uppercase tracking-widest text-slate-400 ml-1"
        >Your Message</label
      >
      <textarea
        id="message"
        name="message"
        rows={6}
        required
        placeholder="Tell me about your project..."
        class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 px-6 text-white placeholder:text-slate-600 focus:outline-none focus:border-violet-500/50 focus:ring-4 focus:ring-violet-500/10 transition-all duration-300 resize-none"
      ></textarea>
    </div>

    <div class="flex flex-col sm:flex-row items-center justify-between gap-6">
      <p
        class="text-[10px] text-slate-500 max-w-[250px] text-center sm:text-left"
      >
        I typically respond within 24 hours. Your data is handled with technical
        excellence.
      </p>
      <div class="flex gap-4 w-full sm:w-auto">
        <button
          type="button"
          class="flex-grow sm:flex-grow-0 px-8 py-4 rounded-2xl border border-white/5 text-slate-400 hover:text-white hover:bg-white/5 transition-all text-sm font-bold uppercase tracking-widest"
          onclick="window.location.reload()"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="flex-grow sm:flex-grow-0 px-10 py-4 rounded-2xl bg-gradient-to-r from-violet-600 to-violet-800 text-white shadow-[0_0_20px_rgba(139,92,246,0.3)] hover:shadow-[0_0_30px_rgba(139,92,246,0.5)] hover:-translate-y-1 active:translate-y-0 transition-all text-sm font-bold uppercase tracking-widest"
        >
          Send Message
        </button>
      </div>
    </div>
  </form>

  <div
    class="flex flex-col fixed bottom-8 left-1/2 -translate-x-1/2 z-[100] w-full max-w-sm px-4"
  >
    <Toast type="Success" className="hidden" />
    <Toast type="Danger" className="hidden" />
  </div>
</div>

<style>
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(40px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .animate-slide-up {
    animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) both;
  }
</style>

<script>
  async function submit_form(e: SubmitEvent) {
    e.preventDefault();
    const target = e.target as HTMLFormElement;
    const btn = target.querySelector(
      'button[type="submit"]',
    ) as HTMLButtonElement;
    const originalText = btn.textContent;
    btn.textContent = "Sending...";
    btn.disabled = true;

    try {
      const formData = {
        email: (document.getElementById("email") as HTMLInputElement).value,
        subject: (document.getElementById("subject") as HTMLInputElement).value,
        message: (document.getElementById("message") as HTMLInputElement).value,
      };

      const response = await fetch("/api/contact_me", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      if (response.ok) {
        showToast("toast-success");
        target.reset();
      } else {
        showToast("toast-danger");
      }
    } catch (error) {
      showToast("toast-danger");
    } finally {
      btn.textContent = originalText;
      btn.disabled = false;
    }
  }

  function showToast(id: string) {
    const toast = document.getElementById(id);
    if (toast) {
      toast.classList.remove("hidden");
      setTimeout(() => toast.classList.add("hidden"), 5000);
    }
  }

  const loginForm = document.getElementById("loginForm");
  if (loginForm) {
    loginForm.addEventListener("submit", submit_form);
  }
</script>
